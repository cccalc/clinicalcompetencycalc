\ProvidesPackage{srs-style}

% ================================================== layout

\usepackage[margin=1.25in]{geometry}
\usepackage{changepage}

\usepackage{multicol}
\setlength{\columnsep}{2em}

\usepackage{nowidow}

% ================================================ language

\usepackage[english]{babel}

% ============================================== typography

\usepackage{fontspec}
\setmainfont{cmunorm.otf}
 [BoldFont =       lmsans10-bold.otf,
  ItalicFont =     cmunoti.otf,
  BoldItalicFont = lmsans10-boldoblique.otf]
\usepackage[normalem]{ulem}

\usepackage{microtype}
\usepackage{parskip}

\usepackage{amssymb}

\frenchspacing
\raggedbottom

% ================================================ headings

\newlength\secspacer
% we do not want em here as it changes with the font size
\setlength\secspacer{12pt} 

\makeatletter
\newcommand{\myhangsecnum}{%
  \def\@seccntformat##1{\llap{\csname the##1\endcsname\kern\secspacer}}}
\makeatother

\makechapterstyle{hangnum}{
%  \setlength{\chapindent}{2em} % <-- What should this be?
  \renewcommand*{\printchaptername}{}
  \renewcommand*{\chapternamenum}{}
  \renewcommand*{\printchapternum}{\noindent\llap{\Huge\bfseries\thechapter\kern\secspacer}}
  \renewcommand*{\afterchapternum}{}
}

\chapterstyle{hangnum}
\myhangsecnum

% \chapterstyle{hangnum}
\renewcommand{\chapterheadstart}{\vspace{\beforechapskip}}

\setsechook{\hangsecnum}
\setsecheadstyle{\Large\bfseries}

\setsubsechook{\defaultsecnum}
\setsubsubsecheadstyle{\itshape}

\setsecnumdepth{subsubsection}

% \usepackage{appendix}

% ===================================================== toc

\usepackage{tocloft}
\cftpagenumbersoff{subsection}
\setcounter{tocdepth}{2}

% ================================================ enumitem

\usepackage{enumitem}

% ================================================== tables

\usepackage{tabularx}
\renewcommand{\arraystretch}{1.25}

% ================================================ graphics

\usepackage{float}
\usepackage{graphicx}
\graphicspath{{./images/}}

% ==================================================== tikz

\usepackage{tikz}
\usepackage{tikzpagenodes}
\usetikzlibrary{calc}

% ================================================ fancyhdr

\usepackage{fancyhdr}
\renewcommand{\chaptermark}[1]{\markboth{\thechapter.\ #1}{}}
\renewcommand{\sectionmark}[1]{\markright{}}
\fancyhead[L]{\rule[-1.5ex]{0pt}{1.5ex}Clinical Competency Calculator SRS}
\fancyfoot[L]{\srsversion}
\fancyfoot[R]{\srsdate}
\fancyfoot[C]{\itshape---~\thepage~---}

\addtolength{\headheight}{6pt}
\addtolength{\footskip}{12pt}

\fancypagestyle{plain}{%
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \fancyfoot[C]{\itshape---~\thepage~---}%
}

% ================================================ hyperref

\usepackage{xurl}
\usepackage[colorlinks,breaklinks=true,linkcolor=teal]{hyperref}
\newcommand{\email}[1]{\href{mailto:#1}{\ttfamily\nolinkurl{#1}}}

% ============================================== glossaries
% ----------------------------- to be loaded after hyperref

\usepackage[nopostdot,abbreviations]{glossaries-extra}

% remove glossary heading
\renewcommand{\glossarysection}[2][]{}%

% place glossary in enumerate environment
\newglossarystyle{enum}{%
  \setglossarystyle{list}%
  \renewenvironment{theglossary}%
    {\begin{enumerate}[
      label=\thesection.\arabic*.,
      ref=\thesection.\arabic*,
      leftmargin=*,
      align=left,
      widest*=99,
    ]}%
    {\end{enumerate}}%
  \renewcommand*{\glossentry}[2]{%
    \item\label{\enumlabel{##1}}\glsentryitem{##1}%
      \glstarget{##1}{\textbf{\glossentryname{##1}:}}
    \glossentrydesc{##1}\glspostdescription\space ##2}%
}

\setglossarystyle{enum}

\renewcommand{\glsseeitemformat}[1]{\ref{\enumlabel{#1}}~\textit{\glsentrytext{#1}}}

\glsaddstoragekey
  {enumlabel}% key/field name
  {enumlabel:\glslabel}% default value if not explicitly set
  {\enumlabel}

% [[ MAIN ]] disable hyperlinks after first mention
\renewcommand*{\glslinkcheckfirsthyperhook}{%
  \ifglsused{\glslabel}{\setkeys{glslink}{hyper=false}}{}%
}

% [[ MAIN ]] bold first mention
\defglsentryfmt[main]{\ifglsused{\glslabel}{\glsgenentryfmt}{\textbf{\glsgenentryfmt}}}

% [[ ABBR ]] remove hyperlinks
\glssetcategoryattribute{abbreviation}{nohyper}{true}

\newabbreviationstyle{also-in-glossary-style}{%
\renewcommand*{\CustomAbbreviationFields}{%
    name={\the\glsshorttok},
    sort={\the\glsshorttok},
    first={\textbf{\the\glslongtok}\space(\the\glslongtok)},
    firstplural={\textbf{\the\glslongpltok}\space(\the\glsshortpltok)},
    text={\the\glsshorttok},
    plural={\the\glsshortpltok},
    description={\the\glslabeltok}
  }%
  \renewcommand*{\GlsXtrPostNewAbbreviation}{%
    \glssetattribute{\the\glslabeltok}{regular}{true}}%
}{%
  \GlsXtrUseAbbrStyleFmts{long-short}%
}

\setabbreviationstyle[also-in-glossary]{also-in-glossary-style}

\makeglossaries
\loadglsentries{gls.tex}

% =========================================== miscellaneous

\usepackage{calc}
\usepackage{pdftexcmds}
\usepackage{soul}
\usepackage{xcolor}

% ========================================= custom commands

\PassOptionsToPackage{toc}{appendix}

\reversemarginpar

\newcommand{\ctext}[3][RGB]{%
  \begingroup
  \definecolor{hlcolor}{#1}{#2}\sethlcolor{hlcolor}%
  \hl{#3}%
  \endgroup
}

\newcommand{\tbd}[1]{%
  \leavevmode\marginpar{\leavevmode\color{red}\Large\textreferencemark~$\Longrightarrow$}%
  \ctext[RGB]{255,223,223}{#1}%
}

\newenvironment{requirements}
  {\begin{enumerate}[
    label=\thesection.\arabic*.,
    ref=\thesection.\arabic*,
    leftmargin=*,
    align=left,
    widest*=99,
  ]}
  {\end{enumerate}}

\newcommand{\req}[1]{\item\label{req:#1}}

\definecolor{imphigh}{RGB}{220,53,69}
\definecolor{impmed}{RGB}{255,193,7}

\makeatletter
\newcommand{\imp}[1]{\par\textit{Importance: }%
  \ifnum\pdf@strcmp{\unexpanded{#1}}{high}=0 %
    \expandafter\@firstoftwo
  \else
    \expandafter\@secondoftwo
  \fi
    {{\color{imphigh}$\blacksquare$} HIGH}%
    {\ifnum\pdf@strcmp{\unexpanded{#1}}{med}=0 %
      \expandafter\@firstoftwo
    \else
      \expandafter\@secondoftwo
    \fi
      {{\color{impmed}$\blacksquare$} MEDIUM}%
      {\ifnum\pdf@strcmp{\unexpanded{#1}}{low}=0 %
        \expandafter\@firstoftwo
      \else
        \expandafter\@secondoftwo
      \fi
        {{\color{gray}$\blacksquare$} LOW}%
        {\MakeUppercase{#1}}%
      }%
    }%
}
\makeatother

\newcommand{\dep}[1]{\par\textit{Dependencies: }#1}